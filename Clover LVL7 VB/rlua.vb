Imports System
Imports System.Diagnostics
Imports System.IO
Imports System.IO.Pipes
Imports System.Net
Imports System.Runtime.InteropServices
Imports System.Text
Imports System.Windows.Forms

Namespace WeAreDevs_API
	Public Class ExploitAPI
		Private client As New WebClient()

		Private injector As New ExploitAPI.BasicInject()

		Private cmdpipe As String = "WeAreDevsPublicAPI_CMD"

		Private luacpipe As String = "WeAreDevsPublicAPI_LuaC"

		Private luapipe As String = "WeAreDevsPublicAPI_Lua"

		Public Sub New()
		End Sub

		Public Sub AddFire(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("fire ", username))
		End Sub

		Public Sub AddSmoke(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("smoke ", username))
		End Sub

		Public Sub AddSparkles(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("sparkles ", username))
		End Sub

		Public Sub ConsolePrint(Optional ByVal text As String = "WeAreDevs Website")
			Me.SendCommand(String.Concat("print ", text))
		End Sub

		Public Sub ConsoleWarn(Optional ByVal text As String = "meWeAreDevs Website")
			Me.SendCommand(String.Concat("warn ", text))
		End Sub

		Public Sub CreateForceField(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("ff ", username))
		End Sub

		Public Sub DoBlockHead(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("blockhead ", username))
		End Sub

		Public Sub DoBTools(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("btools ", username))
		End Sub

		Public Sub DoFloat(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("float ", username))
		End Sub

		Public Sub DoKill(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("kill ", username))
		End Sub

		Public Sub DoNoFloat(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("nofloat ", username))
		End Sub

		Private Function DownloadLatestVersion() As Boolean
			If File.Exists("exploit-main.dll") Then
				File.Delete("exploit-main.dll")
			End If
			Dim str As String = Me.ReadURL("https://pastebin.com/raw/Ly9mJwH7")
			If str.Length > 0 Then
				Me.client.DownloadFile(str.Split(New Char() { " "c })(1), "exploit-main.dll")
			End If
			If File.Exists("exploit-main.dll") Then
				Return True
			End If
			Return False
		End Function

		Public Sub ForceBubbleChat(Optional ByVal username As String = "me", Optional ByVal text As String = "WeAreDevs Website")
			Me.SendCommand(String.Concat("chat ", username, " ", text))
		End Sub

		Public Function IsUpdated() As Boolean
			Dim flag As Boolean = False
			Dim str As String = Me.ReadURL("https://pastebin.com/raw/Ly9mJwH7")
			If str.Length <= 0 Then
				MessageBox.Show("Could not check for the latest version. Did your fireall block us?", "Error")
			Else
				flag = Convert.ToBoolean(str.Split(New Char() { " "c })(0))
			End If
			Return flag
		End Function

		Public Function LaunchExploit() As Boolean
			If ExploitAPI.NamedPipeExist(Me.cmdpipe) Then
				MessageBox.Show("Dll already injected", "No problems")
			ElseIf Not Me.IsUpdated() Then
				MessageBox.Show("Exploit currently patched. Try again tomorrow!", "Error")
			ElseIf Not Me.DownloadLatestVersion() Then
				MessageBox.Show("Could not download the latest version! Did your firewall block us?", "Error")
			Else
				If Me.injector.InjectDLL() Then
					Return True
				End If
				MessageBox.Show("DLL failed to inject", "Error")
			End If
			Return False
		End Function

		Public Sub LuaC_getfield(ByVal index As Integer, ByVal instance As String)
			Me.SendScript(String.Concat(New Object() { "getglobal ", index, " ", instance }))
		End Sub

		Public Sub LuaC_getglobal(ByVal service As String)
			Me.SendScript(String.Concat("getglobal ", service))
		End Sub

		Public Sub LuaC_gettop()
			Me.SendScript("gettop")
		End Sub

		Public Sub LuaC_next(ByVal index As Integer)
			Me.SendScript("next")
		End Sub

		Public Sub LuaC_pcall(ByVal numberOfArguments As Integer, ByVal numberOfResults As Integer, ByVal ErrorFunction As Integer)
			Me.SendScript(String.Concat(New Object() { "pushnumber ", numberOfArguments, " ", numberOfResults, " ", ErrorFunction }))
		End Sub

		Public Sub LuaC_pop(ByVal quantity As Integer)
			Me.SendScript(String.Concat("pop ", quantity))
		End Sub

		Public Sub LuaC_pushboolean(Optional ByVal value As String = "false")
			Me.SendScript(String.Concat("pushboolean ", value))
		End Sub

		Public Sub LuaC_pushnil()
			Me.SendScript("pushnil")
		End Sub

		Public Sub LuaC_pushnumber(ByVal number As Integer)
			Me.SendScript(String.Concat("pushnumber ", number))
		End Sub

		Public Sub LuaC_pushstring(ByVal text As String)
			Me.SendScript(String.Concat("pushstring ", text))
		End Sub

		Public Sub LuaC_pushvalue(ByVal index As Integer)
			Me.SendScript(String.Concat("pushvalue ", index))
		End Sub

		Public Sub LuaC_setfield(ByVal index As Integer, ByVal [property] As String)
			Me.SendScript(String.Concat(New Object() { "setfield ", index, " ", [property] }))
		End Sub

		Public Sub LuaC_settop(ByVal index As Integer)
			Me.SendScript(String.Concat("settop ", index))
		End Sub

		Private Shared Function NamedPipeExist(ByVal pipeName As String) As Boolean
			Dim flag As Boolean
			Dim flag1 As Boolean
			Try
				If Not ExploitAPI.WaitNamedPipe(Path.GetFullPath(String.Format("\\\\.\\pipe\\{0}", pipeName)), 0) Then
					Dim lastWin32Error As Integer = Marshal.GetLastWin32Error()
					If lastWin32Error = 0 Then
						flag = False
						flag1 = flag
						Return flag1
					ElseIf lastWin32Error = 2 Then
						flag = False
						flag1 = flag
						Return flag1
					End If
				End If
				flag = True
				Return flag
			Catch exception As Exception
				flag = False
				Return flag
			End Try
			Return flag1
		End Function

		Public Sub PlaySoundInGame(Optional ByVal assetid As String = "1071384374")
			Me.SendCommand(String.Concat("music ", assetid))
		End Sub

		Private Function ReadURL(ByVal url As String) As String
			Return Me.client.DownloadString(url)
		End Function

		Public Sub RemoveArms(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("noarms ", username))
		End Sub

		Public Sub RemoveFire(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("nofire ", username))
		End Sub

		Public Sub RemoveForceField(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("noff ", username))
		End Sub

		Public Sub RemoveLegs(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("nolegs ", username))
		End Sub

		Public Sub RemoveLimbs(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("nolimbs ", username))
		End Sub

		Public Sub RemoveSparkles(Optional ByVal username As String = "me")
			Me.SendCommand(String.Concat("nosparkles ", username))
		End Sub

		Friend Sub SendCommand(ByVal Command As String)
			Me.SMTP(Me.cmdpipe, Command)
		End Sub

		Public Sub SendLimitedLuaScript(ByVal Script As String)
			Me.SMTP(Me.luapipe, Script)
		End Sub

		Public Sub SendScript(ByVal Script As String)
			Dim strArrays() As String = Script.Split(ControlChars.CrLf.ToCharArray())
			For i As Integer = 0 To (CInt(strArrays.Length)) - 1
				Dim str As String = strArrays(i)
				Try
					Me.SMTP(Me.luacpipe, str)
				Catch exception As Exception
					MessageBox.Show(exception.Message.ToString())
				End Try
			Next i
		End Sub

		Public Sub SetFogEnd(Optional ByVal value As Integer = 0)
			Me.SendCommand(String.Concat("fogend ", value))
		End Sub

		Public Sub SetJumpPower(Optional ByVal value As Integer = 100)
			Me.SendCommand(String.Concat("jumppower ", value))
		End Sub

		Public Sub SetSkyboxImage(Optional ByVal assetid As String = "2143522")
			Me.SendCommand(String.Concat("skybox ", assetid))
		End Sub

		Public Sub SetWalkSpeed(Optional ByVal username As String = "me", Optional ByVal value As Integer = 100)
			Me.SendCommand(String.Concat("speed ", username, " ", value.ToString()))
		End Sub

		Private Sub SMTP(ByVal pipe As String, ByVal input As String)
			If Not ExploitAPI.NamedPipeExist(pipe) Then
				MessageBox.Show("Error occured. Did the dll properly inject?", "Oops", MessageBoxButtons.OK, MessageBoxIcon.Exclamation)
			Else
				Try
					Using namedPipeClientStream As New NamedPipeClientStream(".", pipe, PipeDirection.Out)
						namedPipeClientStream.Connect()
						Using streamWriter As New StreamWriter(namedPipeClientStream)
							streamWriter.Write(input)
							streamWriter.Dispose()
						End Using
						namedPipeClientStream.Dispose()
					End Using
				Catch oException As IOException
					MessageBox.Show("Error occured sending message to the game!", "Connection Failed!", MessageBoxButtons.OK, MessageBoxIcon.Hand)
				Catch exception As Exception
					MessageBox.Show(exception.Message.ToString())
				End Try
			End If
		End Sub

		Public Sub TeleportMyCharacterTo(Optional ByVal target_username As String = "me")
			Me.SendCommand(String.Concat("teleport ", target_username))
		End Sub

		Public Sub ToggleClickTeleport()
			Me.SendCommand("toggleclickteleport")
		End Sub

		<DllImport("kernel32.dll", CharSet:=CharSet.Auto, ExactSpelling:=False, SetLastError:=True)> _
		Private Shared Function WaitNamedPipe(ByVal name As String, ByVal timeout As Integer) As Boolean
		End Function

		Private Class BasicInject
			Public Sub New()
			End Sub

			<DllImport("kernel32.dll", CharSet:=CharSet.None, ExactSpelling:=False)> _
			Friend Shared Function CreateRemoteThread(ByVal hProcess As IntPtr, ByVal lpThreadAttributes As IntPtr, ByVal dwStackSize As UInteger, ByVal lpStartAddress As UIntPtr, ByVal lpParameter As IntPtr, ByVal dwCreationFlags As UInteger, ByRef lpThreadId As IntPtr) As IntPtr
			End Function

			<DllImport("kernel32.dll", CharSet:=CharSet.None, ExactSpelling:=False, SetLastError:=True)> _
			Friend Shared Function FreeLibrary(ByVal hModule As IntPtr) As Boolean
			End Function

			<DllImport("kernel32", CharSet:=CharSet.Ansi, ExactSpelling:=True, SetLastError:=True)> _
			Friend Shared Function GetProcAddress(ByVal hModule As IntPtr, ByVal procName As String) As UIntPtr
			End Function

			Public Function InjectDLL() As Boolean
				Dim uIntPtr As UIntPtr
				Dim intPtr As IntPtr
				If Process.GetProcessesByName("RobloxPlayerBeta").Length = 0 Then
					Return False
				End If
				Dim processesByName As Process = Process.GetProcessesByName("RobloxPlayerBeta")(0)
				Dim bytes() As Byte = (New ASCIIEncoding()).GetBytes(String.Concat(AppDomain.CurrentDomain.BaseDirectory, "exploit-main.dll"))
				Dim intPtr1 As IntPtr = ExploitAPI.BasicInject.LoadLibraryA("kernel32.dll")
				Dim procAddress As UIntPtr = ExploitAPI.BasicInject.GetProcAddress(intPtr1, "LoadLibraryA")
				ExploitAPI.BasicInject.FreeLibrary(intPtr1)
				If procAddress = System.UIntPtr.Zero Then
					Return False
				End If
				Dim intPtr2 As IntPtr = ExploitAPI.BasicInject.OpenProcess(ExploitAPI.BasicInject.ProcessAccess.AllAccess, False, processesByName.Id)
				If intPtr2 = System.IntPtr.Zero Then
					Return False
				End If
				Dim intPtr3 As IntPtr = ExploitAPI.BasicInject.VirtualAllocEx(intPtr2, New IntPtr(0), CUInt(bytes.Length), 12288, 4)
				If intPtr3 = System.IntPtr.Zero Then
					Return False
				End If
				If Not ExploitAPI.BasicInject.WriteProcessMemory(intPtr2, intPtr3, bytes, CUInt(bytes.Length), uIntPtr) Then
					Return False
				End If
				If ExploitAPI.BasicInject.CreateRemoteThread(intPtr2, New IntPtr(0), 0, procAddress, intPtr3, 0, intPtr) = System.IntPtr.Zero Then
					Return False
				End If
				Return True
			End Function

			<DllImport("kernel32", CharSet:=CharSet.Ansi, ExactSpelling:=False, SetLastError:=True)> _
			Friend Shared Function LoadLibraryA(ByVal lpFileName As String) As IntPtr
			End Function

			<DllImport("kernel32.dll", CharSet:=CharSet.None, ExactSpelling:=False)> _
			Friend Shared Function OpenProcess(ByVal dwDesiredAccess As ExploitAPI.BasicInject.ProcessAccess, ByVal bInheritHandle As Boolean, ByVal dwProcessId As Integer) As IntPtr
			End Function

			<DllImport("kernel32.dll", CharSet:=CharSet.None, ExactSpelling:=False, SetLastError:=True)> _
			Friend Shared Function ReadProcessMemory(ByVal hProcess As IntPtr, ByVal lpBaseAddress As IntPtr, <Out()> ByVal lpBuffer() As Byte, ByVal dwSize As Integer, ByRef lpNumberOfBytesRead As Integer) As Boolean
			End Function

			<DllImport("kernel32.dll", CharSet:=CharSet.None, ExactSpelling:=True, SetLastError:=True)> _
			Friend Shared Function VirtualAllocEx(ByVal hProcess As IntPtr, ByVal lpAddress As IntPtr, ByVal dwSize As UInteger, ByVal flAllocationType As UInteger, ByVal flProtect As UInteger) As IntPtr
			End Function

			<DllImport("kernel32.dll", CharSet:=CharSet.None, ExactSpelling:=False, SetLastError:=True)> _
			Friend Shared Function WriteProcessMemory(ByVal hProcess As IntPtr, ByVal lpBaseAddress As IntPtr, ByVal lpBuffer() As Byte, ByVal nSize As UInteger, ByRef lpNumberOfBytesWritten As UIntPtr) As Boolean
			End Function

			<Flags> _
			Public Enum ProcessAccess
				Terminate = 1
				CreateThread = 2
				VMOperation = 8
				VMRead = 16
				VMWrite = 32
				DuplicateHandle = 64
				SetInformation = 512
				QueryInformation = 1024
				Synchronize = 1048576
				AllAccess = 1050235
			End Enum
		End Class
	End Class
End Namespace